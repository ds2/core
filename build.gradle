plugins {
    id "com.jfrog.bintray" version '1.8.0'
    id 'net.researchgate.release' version '2.6.0'
    id 'ds2.base' version '0.0.7'
}


allprojects {
    //apply plugin: 'maven'
    apply plugin: 'com.jfrog.bintray'
    apply plugin: 'ds2.base'

    group = 'ds2.oss.core'

    base {
        javaVersion = JavaVersion.VERSION_1_8
    }
    repositories {
        mavenLocal()
        jcenter()
        maven { url "https://maven.java.net/content/groups/promoted" }
        mavenCentral()
    }

    bintray {
        user = project.hasProperty('bintrayUser') ? project.property('bintrayUser') : System.getenv('BINTRAY_USER')
        key = project.hasProperty('bintrayApiKey') ? project.property('bintrayApiKey') : System.getenv('BINTRAY_API_KEY')
        pkg {
            repo = 'ds2-oss'
            name = 'Core'
            licenses = ['Apache-2.0']
            vcsUrl = 'https://bitbucket.org/lexxy23/ds2-oss-core.git'
        }
        publications = ['core']
    }
    release {
        failOnPublishNeeded = false
        git {
            requireBranch = 'release/0.1'
        }
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'maven-publish'
    //apply plugin: "org.shipkit.java"
    //apply plugin: 'maven'
    //apply plugin: 'net.researchgate.release'

    publishing {
        repositories {
            maven {
                url "$buildDir/repo"
            }
        }
        publications {
            core(MavenPublication) {
                from components.java
                artifact createSourceJar {
                    classifier "sources"
                }
                artifact createJavadocJar {
                    classifier "javadoc"
                }
            }
        }
    }

}

// release stuff

release {
    failOnPublishNeeded = false
    failOnUpdateNeeded = false
    git {
        requireBranch = 'release/0.1'
    }
}

afterReleaseBuild.dependsOn bintrayUpload

bintray {
    publications = []
    configurations = []
}

//beforeReleaseBuild.dependsOn subprojects.install
//afterReleaseBuild.dependsOn subprojects.uploadArchive
